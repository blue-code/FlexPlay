# FlexPlay 🎬

**Flexible Video Player** - 다양한 코덱 지원, 실시간 트랜스코딩, 영상 편집이 가능한 웹 비디오 플레이어

Python Flask 기반의 올인원 영상 재생 및 편집 솔루션입니다.

## 주요 기능

### 기본 기능
- 영상 파일 목록 표시 및 미리보기
- HTML5 비디오 플레이어로 영상 재생
- Range request 지원으로 탐색 가능한 스트리밍

### 재생 컨트롤
- **10초 건너뛰기**: 앞으로/뒤로 10초씩 이동
- **빠른 재생**: 0.5x, 0.75x, 1x, 1.25x, 1.5x, 2x 속도 조절
- **전체화면 모드**: 몰입형 시청 경험
- **재생/일시정지**: 간편한 재생 제어
- **실시간 트랜스코딩**: 아이폰/iOS에서 재생 안 되는 영상을 H.264+AAC로 변환
- **무소음 전체재생**: 목록 전체를 음소거 상태로 연속 재생해 iPad 음악 앱과 병행 청취 가능
- **롱폼 이어보기**: 10분 이상 영상은 재생 위치를 자동 저장해 다음 재생 시 바로 이어보기

### 편집 기능
- **구간 삭제**: 영상에서 원하는 구간을 삭제하여 새 파일 생성
- **다중 구간 지원**: 여러 구간을 한 번에 삭제 가능
- **원본 보존**: 편집된 파일은 새로 생성되며 원본은 유지
- **실시간 진행률**: 편집 진행 상황을 실시간으로 확인

### 파일 관리
- **파일 삭제**: 웹 인터페이스에서 바로 삭제 가능
- **자동 정렬**: 최신 수정 날짜 순으로 정렬
- **선택 이동**: 목록에서 다중 선택 후 지정 경로로 일괄 이동
- **새로고침**: 버튼 한 번으로 영상/폴더 수 및 메타 정보 갱신

### 추천 기능
- **최근 재생 목록**: 최근에 본 영상 5개를 표시
- **재생 기록 저장**: 마지막 재생 위치 기억
- **키보드 단축키**: 빠른 조작을 위한 단축키 지원
  - `Space`: 재생/일시정지
  - `←`: 10초 뒤로
  - `→`: 10초 앞으로
  - `F`: 전체화면
  - `M`: 음소거
  - `↑`: 볼륨 올리기
  - `↓`: 볼륨 내리기
- **반응형 디자인**: 다양한 화면 크기에 최적화
- **아름다운 UI**: 그라디언트 배경과 현대적인 디자인

## 구간 삭제 편집 기능

영상에서 불필요한 구간을 삭제하여 새로운 파일을 생성할 수 있습니다.

### 사용 방법
1. 영상을 선택하여 재생
2. **"✂️ 구간 삭제 편집"** 섹션이 표시됨
3. 삭제할 구간의 시작 지점에서 **"📍 시작점 마크"** 클릭
4. 삭제할 구간의 끝 지점에서 **"📍 끝점 마크"** 클릭
5. 여러 구간을 삭제하려면 3-4단계 반복
6. **"🎬 편집 실행"** 클릭
7. 편집이 완료되면 새 파일이 생성됨 (파일명: `원본파일명_edited_타임스탬프.확장자`)

### 특징
- **원본 파일 보존**: 편집된 영상은 새 파일로 저장되며 원본은 그대로 유지
- **다중 구간 삭제**: 한 번에 여러 구간을 삭제 가능
- **실시간 진행률**: 편집 진행 상황을 실시간으로 확인
- **고속 처리**: FFmpeg의 `-c copy`를 사용하여 재인코딩 없이 빠른 처리

### 주의사항
- 편집 중에는 브라우저를 닫지 마세요
- 대용량 파일은 처리 시간이 오래 걸릴 수 있습니다
- 디스크 여유 공간을 확인하세요 (원본 파일 크기만큼 필요)

## 트랜스코딩 기능 (iPhone/iOS 호환)

일부 MP4 파일이나 다른 형식의 영상이 아이폰/Safari에서 재생되지 않을 경우, **트랜스코딩 기능**을 활성화하세요.

### 사용 방법
1. 웹 플레이어에서 **"📱 트랜스코딩: OFF"** 버튼 클릭
2. 버튼이 녹색으로 변하며 **"ON"** 상태로 전환됨
3. 이제 모든 영상이 **H.264 비디오 + AAC 오디오**로 실시간 변환되어 재생됨
4. iOS/Safari에서 원활하게 재생 가능

### 기술적 세부사항
- **FFmpeg**를 사용한 실시간 트랜스코딩
- 원본 파일은 변경되지 않음 (메모리에서만 변환)
- 스트리밍 최적화로 빠른 시작 시간
- 품질: CRF 23 (고화질 유지)
- 인코딩 프리셋: veryfast (낮은 지연시간)

### 언제 사용하나요?
- ✅ 아이폰/iPad에서 영상이 재생되지 않을 때
- ✅ Safari 브라우저에서 "재생할 수 없음" 오류가 나올 때
- ✅ 구형 코덱(DivX, Xvid 등)으로 인코딩된 MP4 파일
- ❌ 이미 잘 재생되는 영상 (불필요한 CPU 사용)

## 지원 형식

### 일반 형식 (브라우저에서 재생 가능)
- **MP4, M4V** - MPEG-4, H.264, H.265 (가장 권장)
- **WebM** - VP8, VP9, AV1
- **OGV, OGG** - Theora

### 컨테이너 형식 (브라우저 지원 제한적)
- **MKV** - Matroska (코덱에 따라 다름)
- **AVI** - DivX, Xvid 등
- **MOV, QT** - QuickTime
- **FLV, F4V** - Flash Video

### MPEG 계열
- **MPG, MPEG, MPE** - MPEG-1, MPEG-2
- **M2V, M4P** - MPEG-2 Video
- **TS, MTS, M2TS** - Transport Stream, AVCHD

### 모바일/스트리밍
- **3GP, 3G2** - 3GPP

### 레거시/전문가용 형식 (외부 플레이어 권장)
- **WMV, ASF** - Windows Media
- **VOB** - DVD Video
- **RM, RMVB** - RealMedia
- **DivX** - DivX
- **MXF** - Material Exchange Format
- **MOD, TOD** - JVC/Panasonic 캠코더
- **DAT** - VCD
- **DV** - Digital Video
- **AMV** - AMV

**참고:** 브라우저는 MP4(H.264), WebM 형식을 가장 잘 지원합니다.
구형 형식(WMV, RM, VOB 등)은 브라우저에서 재생되지 않을 수 있으며,
VLC 등의 외부 플레이어 사용을 권장합니다.

## 설치 방법

### 1. 초기 설정

```bash
./setup.sh
```

이 명령은 다음을 수행합니다:
- Python 가상환경(venv) 생성
- 필요한 패키지 설치
- 필요한 디렉토리 생성

### 2. 영상 파일 추가

`videos` 폴더에 재생하고 싶은 영상 파일을 넣어주세요.

```bash
cp /path/to/your/video.mp4 videos/
```

## 실행 방법

```bash
./run.sh
```

브라우저에서 다음 주소로 접속:
```
http://localhost:7777
```

## 프로젝트 구조

```
.
├── app.py                 # Flask 백엔드 서버
├── requirements.txt       # Python 패키지 의존성
├── setup.sh              # 설치 스크립트
├── run.sh                # 실행 스크립트
├── templates/
│   └── index.html        # 프론트엔드 UI
├── videos/               # 영상 파일 저장 폴더
├── static/
│   └── thumbnails/       # 썸네일 저장 폴더 (향후 사용)
└── history.json          # 재생 기록 저장 파일
```

## API 엔드포인트

- `GET /`: 메인 페이지
- `GET /api/videos`: 영상 목록 조회
- `GET /api/video/<filename>`: 영상 스트리밍 (직접 재생)
- `GET /api/transcode/<filename>`: 영상 트랜스코딩 스트리밍 (iOS 호환)
- `DELETE /api/delete/<filename>`: 영상 삭제
- `GET /api/history`: 재생 기록 조회
- `POST /api/history`: 재생 기록 저장
- `POST /api/edit`: 영상 편집 작업 시작 (구간 삭제)
- `GET /api/edit/status/<task_id>`: 편집 작업 진행 상황 확인

## 기술 스택

- **백엔드**: Python, Flask
- **프론트엔드**: HTML5, CSS3, JavaScript
- **비디오 재생**: HTML5 Video API
- **스타일**: 순수 CSS (프레임워크 없음)

## 요구사항

- Python 3.7 이상
- 최신 웹 브라우저 (Chrome, Firefox, Safari, Edge)
- **FFmpeg** (트랜스코딩 기능 사용 시 필수)
  - macOS: `brew install ffmpeg`
  - Ubuntu/Debian: `sudo apt install ffmpeg`
  - Windows: [FFmpeg 다운로드](https://ffmpeg.org/download.html)

## 문제 해결

### 영상이 재생되지 않는 경우

1. **트랜스코딩 기능 활성화** - "📱 트랜스코딩" 버튼을 ON으로 변경
2. 브라우저가 해당 영상 포맷을 지원하는지 확인
3. 영상 파일이 손상되지 않았는지 확인
4. 브라우저 콘솔에서 오류 메시지 확인

### 트랜스코딩이 작동하지 않는 경우

1. FFmpeg가 설치되어 있는지 확인: `ffmpeg -version`
2. FFmpeg가 PATH에 포함되어 있는지 확인
3. 서버 로그에서 오류 확인

### 가상환경 활성화 오류

```bash
# 가상환경 수동 활성화
source venv/bin/activate

# 수동으로 서버 실행
python app.py
```

## 향후 개발 계획

- [ ] 영상 썸네일 자동 생성
- [ ] 재생 목록(플레이리스트) 기능
- [ ] 북마크 기능
- [ ] 영상 검색 기능
- [ ] 자막 지원
- [ ] 다중 언어 지원

## 라이선스

이 프로젝트는 개인 사용을 위한 것입니다.
